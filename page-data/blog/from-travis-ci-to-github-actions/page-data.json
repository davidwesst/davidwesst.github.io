{"componentChunkName":"component---src-templates-post-template-js","path":"/blog/from-travis-ci-to-github-actions/","result":{"data":{"markdownRemark":{"excerpt":"Travis CI announced a new pricing model that could have impact on open source projects that are using Travis for continuous integration and/or deployment. For…","html":"<p>Travis CI <a href=\"https://blog.travis-ci.com/2020-11-02-travis-ci-new-billing\">announced a new pricing model</a> that <em>could</em> have impact on open source projects that are using Travis for continuous integration and/or deployment. For static websites, like the <a href=\"https://westerndevs.com\">Western Devs website</a> or <a href=\"https://www.davidwesst.com\">personal website</a>, this could result in getting some unforeseen costs. With that in mind, we decided to take the plunge an migrate away from Travis and over to <a href=\"https://docs.github.com/en/free-pro-team@latest/actions\">GitHub Actions</a> as they provide CI and CD workflows free for open source projects.</p>\n<h2>TL;DR; — Just show me the code</h2>\n<p>Fine. <a href=\"https://github.com/westerndevs/western-devs-website/blob/master/.github/workflows/ci-cd.yml\">Here is is</a>. It is open source after all.</p>\n<p>But just to be clear, this isn’t a tutorial on how to code this up, rather its a walkthrough on what it took to get our <a href=\"https://hexo.io/\">Hexo</a> based static site from Travis to GitHub Actions.</p>\n<h2>Start with Mapping Out Your Workflow</h2>\n<p>And I mean <em>workflow</em> and not just the build. </p>\n<p>For the Western Devs, our workflow goes like this:</p>\n<ol>\n<li>Commit a change to the code (i.e. a new blog post)</li>\n<li>Build the website</li>\n<li>If master branch build is successful, deploy the build to production</li>\n<li>Notify the Western Devs of the build result in Slack</li>\n</ol>\n<p>GitHub workflow provides everything we need to do this, and I’ll walk you through the code, which you can see for yourself in <a href=\"https://github.com/westerndevs/western-devs-website/blob/master/.github/workflows/ci-cd.yml\">here in our GitHub repo</a>.</p>\n<h3>1. Commit a change to the code (i.e. a new blog post)</h3>\n<p>This is our trigger to start the workflow. That is represented by the <code class=\"language-text\">on</code> section of the YAML. In our case, we want to trigger the workflow every time there is a pull request created for the master branch, a push to the master branch (i.e. a merge), or a push to any other feature (ft) or hotfix (hf) branches.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> CI/CD\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> master\n      <span class=\"token punctuation\">-</span> ft/*\n      <span class=\"token punctuation\">-</span> hf/*\n  <span class=\"token key atrule\">pull_request</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> master <span class=\"token punctuation\">]</span></code></pre></div>\n<p>Now we have a workflow that will trigger when we want to. Next, we need to actually build the website.</p>\n<h3>2. Build the website</h3>\n<p>Our build is exceptionally simple— just generate the site, and if the generation is successful, the build was successful. To do this, we create a <code class=\"language-text\">build</code> job that handles the work.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">build</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build and Deploy\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v2 <span class=\"token comment\"># checkout the source code</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>node@v1 <span class=\"token comment\"># setup the environment</span>\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">node-version</span><span class=\"token punctuation\">:</span> <span class=\"token number\">12</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install <span class=\"token comment\"># setup dependencies</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build <span class=\"token comment\"># run the build command</span></code></pre></div>\n<p>The first two steps are using GitHub Actions provided by GitHub themselves. This pulls our source code and the sets up the Node environment that we need to build the website. Once that is done, we  <code class=\"language-text\">run</code> steps to run shell commands to install our project specific dependendies and run the build script itself. </p>\n<p>The scripts have been defined in our <a href=\"https://github.com/westerndevs/western-devs-website/blob/master/package.json\">project <code class=\"language-text\">package.json</code> file</a> and are used by the developers to build the site locally as well.</p>\n<h3>3. If master branch build is successful, deploy the build to production</h3>\n<p>If we are talking about the master branch, we want to do a deployment if it is successful. For this step, we added a conditional expression using the <code class=\"language-text\">github</code> context that is provided to all actions. You can learn more about context and expressions for GitHub Actions in the <a href=\"https://docs.github.com/en/free-pro-team@latest/actions/reference/context-and-expression-syntax-for-github-actions#about-contexts-and-expressions\">GitHub Docs here</a>.</p>\n<p>You might also see that were using an encrypted secret using the <code class=\"language-text\">secret.GITHUB_TOKEN</code> expression. All repositories have this feature in the settings section of the repo, and you can learn more about <a href=\"https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets\">creating encrypted secrets for a repository here</a> in the GitHub docs.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy to GitHub Pages\n      <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> github.ref == 'refs/heads/master'\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> peaceiris/actions<span class=\"token punctuation\">-</span>gh<span class=\"token punctuation\">-</span>pages@v3\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">github_token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GITHUB_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">cname</span><span class=\"token punctuation\">:</span> westerndevs.com\n        <span class=\"token key atrule\">commit_message</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> github.event.head_commit.message <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<h4>BONUS: Free hosting with GitHub Pages</h4>\n<p>In our case, our deployment target is <a href=\"https://pages.github.com/\">GitHub Pages</a> which provides free hosting and SSL certificates for open source static sites sites like ours. </p>\n<p>We decided to take this opportunity to consilate everything under the GitHub umbrella because it saved us a couple of bucks, and now everything we need to manage the site is in one spot rather than spread across multiple cloud services.</p>\n<h3>4. Notify the Western Devs of the build result in Slack</h3>\n<p>Originally, we had forgotten this step and started to feel it right away. So an issue was created and I put a solution in place in about 15 minutes, thanks to someone else doing all the heavy lifting and publishing their work to the <a href=\"https://github.com/marketplace?type=actions\">GitHub Actions Marketplace</a>.</p>\n<p>Slack supports incoming webhooks, even for for free workspaces. I set that up by following the <a href=\"https://api.slack.com/messaging/webhooks\">Slack documentation</a>, created another secret in our repository and voila, we were back in business wih the notifications.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\">    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Notify Slack\n      <span class=\"token key atrule\">if</span><span class=\"token punctuation\">:</span> always()\n      <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> 8398a7/action<span class=\"token punctuation\">-</span>slack@v3\n      <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">status</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> job.status <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">fields</span><span class=\"token punctuation\">:</span> repo<span class=\"token punctuation\">,</span>message<span class=\"token punctuation\">,</span>commit<span class=\"token punctuation\">,</span>author<span class=\"token punctuation\">,</span>action<span class=\"token punctuation\">,</span>eventName<span class=\"token punctuation\">,</span>ref<span class=\"token punctuation\">,</span>workflow<span class=\"token punctuation\">,</span>job<span class=\"token punctuation\">,</span>took <span class=\"token comment\"># selectable (default: repo,message)</span>\n      <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">SLACK_WEBHOOK_URL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.SLACK_WEBHOOK_URL <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token comment\"># required</span></code></pre></div>\n<h2>Conclusion</h2>\n<p>The combination of GitHub Actions and GitHub Pages provides every developer with the opportunity to get a taste of DevOps while actually producing something they can show off to their peers and community. Travis CI is, and will continue to be, a great CI/CD solution for developers…but if you’re looking for a one-stop-shop for source control, workflow, and hosting. You can’t really go wrong with GitHub.</p>","frontmatter":{"title":"From Travis CI to GitHub Actions (and GitHub Pages)","tags":["github actions","github workflow","travis ci","continuous integration","continuous deployment"],"categories":["development"],"date":"November 10, 2020","description":null,"social_image":null}},"prev":null,"next":{"frontmatter":{"title":"New Artwork and a Complete Rewrite...ish | Out the Door Devlog"},"fields":{"slug":"/blog/out-the-door-post-jam-update/"}}},"pageContext":{"slug":"/blog/from-travis-ci-to-github-actions/","prevSlug":null,"nextSlug":"/blog/out-the-door-post-jam-update/"}},"staticQueryHashes":["2555585279","2841359383","3159585216"]}